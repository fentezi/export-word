# export-word

Сервис для экспорта слов и их переводов из Kafka в файл и отправки его по электронной почте.

## Описание

Этот сервис предназначен для считывания сообщений из топика Kafka, содержащих слова и их переводы. Сервис сохраняет эти данные в базе данных MongoDB. Периодически (раз в 15 секунд), он извлекает из MongoDB новые слова, которые ещё не были отправлены, записывает их в файл `words.txt` и отправляет этот файл по электронной почте Gmail.

## Функциональность

*   **Чтение из Kafka:** Потребление сообщений из указанного топика Kafka.
*   **Сохранение в MongoDB:** Сохранение слов и их переводов в базу данных MongoDB.
*   **Периодическая запись в файл:** Запись непрочитанных слов в файл `words.txt`.
*   **Отправка по Gmail:** Отправка файла `words.txt` по электронной почте Gmail.
* **Счетчик слов**: После отправки письма, считает сколько слов было отправлено.
*   **Логирование:** Подробное логирование работы сервиса с различными уровнями (debug, info, error).
*   **Безопасность:** Конфиденциальные данные (пароли, строки подключения) хранятся в переменных окружения и не отображаются в логах.

## Технологии

*   **Go:** Язык программирования.
*   **Kafka:** Система обмена сообщениями.
*   **MongoDB:** База данных.
*   **Gmail:** Сервис электронной почты.
* **Slog**: Логгер

## Структура проекта

*   **`cmd/export-word/main.go`:** Главный файл приложения.
*   **`config/config.go`:** Загрузка и обработка конфигурации.
*   **`internal/kafka/kafka.go`:** Взаимодействие с Kafka.
*   **`internal/repository/repository.go`:** Взаимодействие с MongoDB.
*   **`internal/gmail/gmail.go`:** Взаимодействие с Gmail.
*   **`internal/service/service.go`:** Бизнес-логика приложения.
*   **`internal/entity/entity.go`:** Структуры данных.
*   **`pkg/logger/logger.go`:** Настройка логгера.
*   **`.env`:** Файл с переменными окружения (должен быть в `.gitignore`).
*   **`config.yml`:** Файл с настройками приложения.
* **`Makefile`**: Makefile для запуска приложения.
* **`words.txt`**: Файл куда записываются новые слова.
* **`logs`**: Папка для логирования (создается автоматически).
* **`.gitignore`**: Список файлов, которые не будут загружаться в репозиторий.

## Установка и запуск

1.  **Клонируйте репозиторий:**

    ```bash
    git clone https://github.com/fentezi/export-word
    ```

2.  **Перейдите в директорию проекта:**

    ```bash
    cd export-word
    ```

3.  **Создайте файл `.env`** в корне проекта и заполните его переменными окружения (используйте `.env.example` как шаблон):

    ```
    GMAIL_EMAIL=your_gmail@gmail.com
    GMAIL_PASSWORD=your_gmail_password
    KAFKA_TOPIC=words
    MONGO_URL="mongodb+srv://<user>:<password>@<host>/<database>?retryWrites=true&w=majority&appName=<appname>"
    ```
    *   `GMAIL_EMAIL`: Ваша почта Gmail.
    *   `GMAIL_PASSWORD`: Пароль приложения Gmail.
    *   `KAFKA_TOPIC`: Топик Kafka, из которого читаются сообщения.
    *   `MONGO_URL`: Строка подключения к MongoDB.
4. **Создайте `config.yml`** В данном файле находятся основные настройки приложения.
    ```yaml
    env: "dev" # prod or dev
    server:
      host: "localhost"
      port: "8070"
    kafka:
      address: "localhost"
      port: "29092"
    mongo:
      database: "words"
    ```
5.  **Запустите приложение:**

    ```bash
    make run
    ```

## Использование

1.  **Запуск Kafka:** Убедитесь, что у вас запущен Kafka.
2.  **Отправка сообщений в Kafka:** Отправляйте сообщения в топик `words` в формате JSON, например:

    ```json
    {"eventID": "some-uuid", "word": "example", "translation": "пример"}
    ```

    *   `eventID`: Уникальный идентификатор события (uuid).
    *   `word`: Слово.
    *   `translation`: Перевод слова.

3.  **Просмотр файла `words.txt`:** Слова и их переводы будут периодически добавляться в этот файл.
4. **Просмотр почты**: Файл с новыми словами будет отправляться на почту.
5. **Просмотр логов**: В папке `logs` можно посмотреть все логи.

## Переменные окружения

*   `GMAIL_EMAIL`: Адрес электронной почты Gmail.
*   `GMAIL_PASSWORD`: Пароль приложения Gmail.
*   `KAFKA_TOPIC`: Название топика Kafka.
*   `MONGO_URL`: Строка подключения к MongoDB.
* `CONFIG_PATH`: Путь к файлу `config.yml`, если не указан, то используется `./config.yml`.

## Логирование

Логи пишутся в папку `logs` и в консоль. В production-окружении конфиденциальные данные (пароли, строки подключения) заменяются на `****`.

## Авторы

*   [fentezi](https://github.com/fentezi)
## Лицензия

Этот проект распространяется под лицензией [MIT](./LICENSE).